library(gbd5q0)
library(dbqueries)
library(data.table)
library(assertable)

context("Data Container")

gbd_2017_locations <- c(1, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 
                        19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 
                        33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 
                        47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 
                        61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 
                        75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 
                        89, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 100, 101, 
                        102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 
                        113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 123, 
                        124, 125, 126, 127, 128, 129, 130, 131, 132, 133, 134, 
                        135, 136, 137, 138, 139, 140, 141, 142, 143, 144, 145, 
                        146, 147, 148, 149, 150, 151, 152, 153, 154, 155, 156, 
                        157, 158, 159, 160, 161, 162, 163, 164, 165, 166, 167, 
                        168, 169, 170, 171, 172, 173, 174, 175, 176, 177, 178, 
                        179, 180, 181, 182, 183, 184, 185, 186, 187, 189, 190, 
                        191, 192, 193, 194, 195, 196, 197, 198, 199, 200, 201, 
                        202, 203, 204, 205, 206, 207, 208, 209, 210, 211, 212, 
                        213, 214, 215, 216, 217, 218, 298, 305, 349, 351, 354, 
                        361, 376, 385, 422, 433, 434, 435, 482, 483, 484, 485, 
                        486, 487, 488, 489, 490, 491, 492, 493, 494, 495, 496, 
                        497, 498, 499, 500, 501, 502, 503, 504, 505, 506, 507, 
                        508, 509, 510, 511, 512, 513, 514, 515, 516, 517, 518, 
                        519, 520, 521, 522, 523, 524, 525, 526, 527, 528, 529, 
                        530, 531, 532, 533, 534, 535, 536, 537, 538, 539, 540, 
                        541, 542, 543, 544, 545, 546, 547, 548, 549, 550, 551, 
                        552, 553, 554, 555, 556, 557, 558, 559, 560, 561, 562, 
                        563, 564, 565, 566, 567, 568, 569, 570, 571, 572, 573, 
                        4618, 4619, 4620, 4621, 4622, 4623, 4624, 4625, 4626, 
                        4636, 4643, 4644, 4645, 4646, 4647, 4648, 4649, 4650, 
                        4651, 4652, 4653, 4654, 4655, 4656, 4657, 4658, 4659, 
                        4660, 4661, 4662, 4663, 4664, 4665, 4666, 4667, 4668, 
                        4669, 4670, 4671, 4672, 4673, 4674, 4709, 4710, 4711, 
                        4712, 4713, 4714, 4715, 4716, 4717, 4718, 4719, 4720, 
                        4721, 4722, 4723, 4724, 4725, 4726, 4727, 4728, 4729, 
                        4730, 4731, 4732, 4733, 4734, 4735, 4736, 4737, 4738, 
                        4739, 4740, 4741, 4742, 4749, 4750, 4751, 4752, 4753, 
                        4754, 4755, 4756, 4757, 4758, 4759, 4760, 4761, 4762, 
                        4763, 4764, 4765, 4766, 4767, 4768, 4769, 4770, 4771, 
                        4772, 4773, 4774, 4775, 4776, 4841, 4842, 4843, 4844, 
                        4846, 4849, 4850, 4851, 4852, 4853, 4854, 4855, 4856, 
                        4857, 4859, 4860, 4861, 4862, 4863, 4864, 4865, 4867, 
                        4868, 4869, 4870, 4871, 4872, 4873, 4874, 4875, 4940, 
                        4944, 35424, 35425, 35426, 35427, 35428, 35429, 35430, 
                        35431, 35432, 35433, 35434, 35435, 35436, 35437, 35438, 
                        35439, 35440, 35441, 35442, 35443, 35444, 35445, 35446, 
                        35447, 35448, 35449, 35450, 35451, 35452, 35453, 35454, 
                        35455, 35456, 35457, 35458, 35459, 35460, 35461, 35462, 
                        35463, 35464, 35465, 35466, 35467, 35468, 35469, 35470, 
                        35617, 35618, 35619, 35620, 35621, 35622, 35623, 35624, 
                        35625, 35626, 35627, 35628, 35629, 35630, 35631, 35632, 
                        35633, 35634, 35635, 35636, 35637, 35638, 35639, 35640, 
                        35641, 35642, 35643, 35644, 35645, 35646, 35647, 35648, 
                        35649, 35650, 35651, 35652, 35653, 35654, 35655, 35656, 
                        35657, 35658, 35659, 35660, 35661, 35662, 35663, 43872, 
                        43873, 43874, 43875, 43877, 43880, 43881, 43882, 43883, 
                        43884, 43885, 43886, 43887, 43888, 43890, 43891, 43892, 
                        43893, 43894, 43895, 43896, 43898, 43899, 43900, 43901, 
                        43902, 43903, 43904, 43905, 43906, 43908, 43909, 43910, 
                        43911, 43913, 43916, 43917, 43918, 43919, 43920, 43921, 
                        43922, 43923, 43924, 43926, 43927, 43928, 43929, 43930, 
                        43931, 43932, 43934, 43935, 43936, 43937, 43938, 43939, 
                        43940, 43941, 43942, 44533, 44538, 44539, 44540, 44643, 
                        44644, 44645, 44646, 44647, 44648, 44649, 44650, 44651, 
                        44652, 44653, 44654, 44655, 44656, 44657, 44658, 44659, 
                        44660, 44661, 44662, 44663, 44664, 44665, 44666, 44667, 
                        44668, 44669, 44670, 44671, 44672, 44673, 44674, 44675, 
                        44676, 44677, 44678, 44679, 44680, 44681, 44682, 44683, 
                        44684, 44685, 44686, 44687, 44688, 44689, 44690, 44691, 
                        44692, 44693, 44694, 44695, 44696, 44697, 44698, 44699, 
                        44700, 44701, 44702, 44703, 44704, 44705, 44706, 44707, 
                        44708, 44709, 44710, 44711, 44712, 44713, 44714, 44715, 
                        44716, 44717, 44718, 44719, 44720, 44721, 44722, 44723, 
                        44724, 44725, 44726, 44727, 44728, 44729, 44730, 44731, 
                        44732, 44733, 44734, 44735, 44736, 44737, 44738, 44739, 
                        44740, 44741, 44742, 44743, 44744, 44745, 44746, 44747, 
                        44748, 44749, 44750, 44751, 44752, 44753, 44754, 44755, 
                        44756, 44757, 44758, 44759, 44760, 44761, 44762, 44763, 
                        44764, 44765, 44766, 44767, 44768, 44769, 44770, 44771, 
                        44772, 44773, 44774, 44775, 44776, 44777, 44778, 44779, 
                        44780, 44781, 44782, 44783, 44784, 44785, 44786, 44787, 
                        44788, 44789, 44790, 44791, 44792, 44793, 44794, 44795, 
                        44796, 44797, 44798, 44799, 44800, 44850, 44851, 44852, 
                        44853, 44854, 44855, 44856, 44857, 44858, 44859, 44860, 
                        44861, 44862, 44864, 44865, 44866, 44867, 44868, 44869, 
                        44870, 44871, 44872, 44873, 44874, 44875, 44876, 44877, 
                        44878, 44879, 44880, 44881, 44882, 44883, 44884, 44885, 
                        44886, 44887, 44888, 44889, 44890, 44891, 44892, 44893, 
                        44894, 44895, 44896, 44897, 44898, 44899, 44900, 44901, 
                        44902, 44903, 44904, 44905, 44906, 44907, 44908, 44909, 
                        44910, 44911, 44912, 44913, 44914, 44915, 44916, 44917, 
                        44918, 44919, 44920, 44921, 44922, 44923, 44924, 44925, 
                        44926, 44927, 44928, 44929, 44930, 44931, 44932, 44933, 
                        44934, 44935, 44936, 44937, 44938, 44939, 44940, 44941, 
                        44942, 44943, 44944, 44945, 44946, 44947, 44948, 44949, 
                        44950, 44951, 44952, 44953, 44954, 44955, 44956, 44957, 
                        44958, 44959, 44960, 44961, 44962, 44963, 44964, 44965, 
                        44966, 44967, 44968, 44969, 44970, 44971, 44972, 44973, 
                        44974, 44975, 44976, 44977, 44978, 44979, 44980, 44981, 
                        44982, 44983, 44984, 44985, 44986, 44987)

gbd_2017_years <- c(1950:2017)

# GBD 2017 Tests
test_that("Make sure LDI has all data for GBD 2017 we need", {
  gbd_round <- 2017
  gbd_round_id <- 5
  
  # Get set of locations, years, sexes, and locations
  location_data <- dbqueries::get_locations(location_set_id = 21, gbd_round_id = 5)
  location_data <- location_data[location_data$level >= 3, ]
  location_ids <- unique(location_data$location_id)
  location_ids <- c(location_ids, 44849)
  year_ids <- gbd_2017_years
  index_ids <- list(location_id = location_ids, year_id = year_ids)
  
  # Get DataContainer
  dc <- gbd5q0::DataContainer$new(gbd_round_id = gbd_round_id)

  # Assert that things are as we expect
  assert_ids(dc$get("ldi"), index_ids)
})
